<!DOCTYPE html>
<html>
 <head>
  <title>WEBNEWS by Applh.com</title>
   <script src="phonegap.js"></script>
   <script type="text/javascript" charset="utf-8">
var WN={};

WN.init_phonegap=function() {
 
   WN.debug("DEVICE READY");

   WN.debug("DEVICE INFO");
   var element = document.getElementById('device-info');
   element.innerHTML = 'Device Name: '     + device.name     + '<br />' + 
                            'Device Cordova: '  + device.cordova + '<br />' + 
                            'Device Platform: ' + device.platform + '<br />' + 
                            'Device UUID: '     + device.uuid     + '<br />' + 
                            'Device Version: '  + device.version  + '<br />';

   WN.debug("FILE SYSTEM");
   window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, WN.init_FS_ready, WN.init_FS_fail);
};

WN.bname_cache="webnews.txt";
WN.init_FS_ready=function (fileSystem) {
   WN.debug("file webnews.txt");
   fileSystem.root.getFile(WN.bname_cache, {create: true, exclusive: false}, WN.init_FS_prepare, WN.init_FS_fail);
   
   WN.debug("server download");
   WN.file_cache=fileSystem.root.fullPath+"/"+WN.bname_cache;
   WN.server_download();   
}
WN.init_FS_prepare=function (fileEntry) {
   fileEntry.createWriter(WN.init_FS_start, WN.init_FS_fail);
}
WN.init_FS_start=function (writer) {
   writer.write("http://Applh.com");
}

WN.server_download=function() {
   // !! Assumes filePath is a valid path on the device
   filePath=WN.file_cache;
   var fileTransfer = new FileTransfer();
   var uri = encodeURI("http://applh.com/robots.txt");

   fileTransfer.download(
    uri,
    filePath,
    function(entry) {
        WN.debug("download complete: " + entry.fullPath);
        WN.file_config_load();
        
    },
    function(error) {
        WN.debug("download error source " + error.source);
        WN.debug("download error target " + error.target);
        WN.debug("upload error code" + error.code);
    }
   );
};


WN.file_config_load=function () {
   fileSystem.root.getFile(WN.bname_cache, {create: true, exclusive: false}, WN.config_prepare, WN.init_FS_fail);
};
WN.config_prepare=function(fileEntry) {
 fileEntry.file(WN.config_read, WN.init_FS_fail);
};
WN.config_read=function(file) {
   var reader = new FileReader();
   reader.onloadend = function (evt) {
      WN.debug("Read as text");
      WN.config_text=evt.target.result;
      WN.debug(WN.config_text);
   };
   reader.readAsText(file);
};

WN.init_FS_fail=function (evt) {
   WN.debug(evt.target.error.code);
}

WN.debug_step=0;
WN.debug=function(msg) {
  WN.debug_step++;
  
  //alert(WN.debug_step + '. ' +msg);
 
  var element = document.getElementById('debug-info');
  element.innerHTML+='<div>'+WN.debug_step+'. '+msg+'</div>';
};

// Wait for Cordova to load
document.addEventListener("deviceready", WN.init_phonegap, false);

   </script>
 </head>
 <body>
 <h1>Web News</h1>
 
<div id="device-info">device info...</div>
<div id="debug-info">debug info...</div>
 </body>
</html>
